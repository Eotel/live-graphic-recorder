import i18n from "i18next";
import LanguageDetector from "i18next-browser-languagedetector";
import { initReactI18next } from "react-i18next";

export const LANGUAGE_STORAGE_KEY = "app_lang";

const resources = {
  en: {
    translation: {
      common: {
        appName: "Live Graphic Recorder",
        language: "Language",
        languageJa: "日本語",
        languageEn: "English",
        logout: "Log out",
        accountMenu: "Account menu",
        loading: "Loading...",
        retry: "Retry",
        start: "Start",
        cancel: "Cancel",
        back: "Back",
        unknown: "Unknown",
      },
      auth: {
        checkingStatus: "Checking authentication...",
        loginDescription: "Log in to view your meetings.",
        signupDescription: "Create a new account.",
        emailLabel: "Email",
        passwordLabel: "Password",
        emailPlaceholder: "you@example.com",
        passwordPlaceholderLogin: "Password",
        passwordPlaceholderSignup:
          "At least 12 chars with uppercase/lowercase letters, number, and symbol",
        invalidEmail: "Please enter a valid email address.",
        passwordRequired: "Please enter a password.",
        loginFailed: "Login failed.",
        signupFailed: "Failed to create account.",
        submitting: "Submitting...",
        login: "Log in",
        signup: "Sign up",
        noAccount: "Don't have an account?",
        hasAccount: "Already have an account?",
        goSignup: "Create account",
        goLogin: "Back to login",
      },
      admin: {
        title: "Admin",
        signedInAs: "Signed in as {{email}} ({{role}})",
        backToApp: "Back to App",
        accessDeniedTitle: "Admin access required",
        accessDeniedDescription:
          "Your account does not have admin/staff permission to view this page.",
        filtersTitle: "Session Filters",
        filtersDescription: "Filter and inspect sessions across all users",
        searchPlaceholder: "Search by session ID / meeting title / owner email",
        from: "From",
        to: "To",
        applyFilters: "Apply Filters",
        sessionListTitle: "All Sessions",
        sessionListMeta: "{{total}} sessions",
        loadListFailed: "Failed to load session list.",
        noSessions: "No sessions found.",
        previous: "Previous",
        next: "Next",
        page: "Page {{current}} / {{total}}",
        sessionDetailTitle: "Session Detail",
        sessionDetailDescription: "Metadata and history summary counts",
        loadDetailFailed: "Failed to load session detail.",
        selectSessionPrompt: "Select a session from the list.",
        unassignedOwner: "Unassigned owner",
        notEnded: "Not ended",
        labels: {
          sessionId: "Session ID",
          meetingId: "Meeting ID",
          owner: "Owner",
          startedAt: "Started at",
          endedAt: "Ended at",
        },
        countsTitle: "History Summary",
        counts: {
          transcripts: "Transcript segments: {{count}}",
          analyses: "Analyses: {{count}}",
          images: "Generated images: {{count}}",
          captures: "Camera captures: {{count}}",
          audio: "Audio recordings: {{count}}",
        },
        status: {
          all: "All status",
          idle: "Idle",
          recording: "Recording",
          processing: "Processing",
          error: "Error",
        },
      },
      meeting: {
        newMeetingDialogTitle: "New Meeting",
        titlePlaceholder: "Meeting title",
        titlePlaceholderOptional: "Meeting title (optional)",
        startNewMeeting: "Start New Meeting",
        pastMeetings: "Past Meetings",
        refresh: "Refresh",
        refreshMeetingList: "Refresh meeting list",
        listConnectionUnstable: "Connection is unstable. You can refresh to retry.",
        listUpdating: "Updating past meetings...",
        noPastMeetings: "No past meetings",
        unknownDate: "Unknown",
        untitled: "Untitled Meeting",
        clickToEditTitle: "Click to edit title",
        listTimeoutError: "Failed to load past meetings. Please try again.",
        sectionTitle: "Meeting",
        newMeeting: "New Meeting",
        noPreviousMeetings: "No previous meetings",
        readOnlyBadge: "Read only",
        resumeMeeting: "Resume Meeting",
      },
      report: {
        menu: "Download",
        download: "Download Report",
        downloadAudio: "Download Audio",
        downloadSelectedAudio: "Download Selected Audio",
        audioSelectLabel: "Select audio to download",
        audioLoading: "Loading audio list...",
        audioEmpty: "No audio available",
        audioLoadFailed: "Failed to load audio list.",
        downloading: "Downloading report...",
        downloadFailed: "Failed to download the report.",
      },
      dialog: {
        discardUnsavedRecording: "You have unsaved local audio. Leave this meeting and discard it?",
      },
      recording: {
        grantCameraMic: "Grant Camera & Mic Access",
        shareScreenMic: "Share Screen & Mic",
        stopRecording: "Stop Recording",
        startRecording: "Start Recording",
        selectMeetingFirst: "Select Meeting First",
        startOrJoinMeetingFirst: "Start or join a meeting first",
        readOnly: "Read only",
        permissionDeniedHelp:
          "Check your browser settings to enable camera/microphone access for this site.",
        saveToCloud: "Save to Cloud",
        uploadingWithProgress: "Uploading... {{progress}}%",
        saved: "Saved",
        cancelUpload: "Cancel upload",
        selectMicrophone: "Select microphone",
        microphoneWithIndex: "Microphone {{index}}",
        selectCamera: "Select camera",
        cameraWithIndex: "Camera {{index}}",
        camera: "Camera",
        screen: "Screen",
        cameraNotAvailable: "Camera not available",
        screenNotShared: "Screen not shared",
        recIndicator: "REC",
        sttReconnecting: "Speech-to-text reconnecting (attempt {{attempt}})...",
        sttDegraded: "Speech-to-text temporarily unavailable. Recording continues.",
        sttFailed: "Speech-to-text recovery failed. Try restarting recording.",
      },
      summary: {
        title: "Summary",
        previousPage: "Previous summary page",
        nextPage: "Next summary page",
        pageLabel: "Page {{index}}",
        viewList: "List view",
        viewPaged: "Page view",
        switchToListView: "Switch summary to list view",
        switchToPagedView: "Switch summary to page view",
        liveTranscript: "Live Transcript",
        emptyTranscript: "Start recording to see the transcript...",
        analyzing: "Analyzing...",
        noTopicDetected: "No topic detected",
        speakerWithIndex: "Speaker {{index}}",
        editSpeakerLabel: "Edit speaker {{index}} label",
      },
      graphics: {
        tooltip: "Flash (speed) / Pro (quality)\\nCurrent: {{model}}",
        flash: "Flash",
        pro: "Pro",
        proNotConfigured: "Pro model is not configured (GEMINI_IMAGE_MODEL_PRO)",
        failedToLoadImage: "Failed to load image",
        previousImage: "Previous image",
        nextImage: "Next image",
        placeholder: "Graphic recordings will appear here",
        thumbnailAlt: "Thumbnail {{index}}",
        retrying: "Retrying...",
        generatingImage: "Generating image...",
      },
      layout: {
        expandPane: "Expand pane",
        popoutPane: "Pop out pane",
        collapsePane: "Collapse pane",
        paneOpenInSeparateWindow: "{{label}} is open in a separate window",
        clickToFocus: "Click to focus",
        paneSummary: "Summary",
        paneCamera: "Camera",
        paneGraphics: "Graphics",
      },
      metrics: {
        flow: "Flow",
        heat: "Heat",
      },
    },
  },
  ja: {
    translation: {
      common: {
        appName: "Live Graphic Recorder",
        language: "言語",
        languageJa: "日本語",
        languageEn: "English",
        logout: "ログアウト",
        accountMenu: "アカウントメニュー",
        loading: "読み込み中...",
        retry: "再試行",
        start: "開始",
        cancel: "キャンセル",
        back: "戻る",
        unknown: "不明",
      },
      auth: {
        checkingStatus: "認証状態を確認中...",
        loginDescription: "ログインして会議一覧を表示します",
        signupDescription: "新規アカウントを作成します",
        emailLabel: "メールアドレス",
        passwordLabel: "パスワード",
        emailPlaceholder: "you@example.com",
        passwordPlaceholderLogin: "パスワード",
        passwordPlaceholderSignup: "12文字以上・英大小/数字/記号を含む",
        invalidEmail: "有効なメールアドレスを入力してください",
        passwordRequired: "パスワードを入力してください",
        loginFailed: "ログインに失敗しました",
        signupFailed: "アカウント作成に失敗しました",
        submitting: "処理中...",
        login: "ログイン",
        signup: "アカウント作成",
        noAccount: "アカウント未登録ですか？",
        hasAccount: "既にアカウントをお持ちですか？",
        goSignup: "新規登録",
        goLogin: "ログインへ",
      },
      admin: {
        title: "Admin",
        signedInAs: "{{email}} でログイン中（{{role}}）",
        backToApp: "アプリに戻る",
        accessDeniedTitle: "管理画面へのアクセス権限がありません",
        accessDeniedDescription: "このページを表示するには admin または staff 権限が必要です。",
        filtersTitle: "セッション絞り込み",
        filtersDescription: "全ユーザーのセッションを横断して確認します",
        searchPlaceholder: "session ID / 会議タイトル / owner email で検索",
        from: "開始日時（From）",
        to: "終了日時（To）",
        applyFilters: "適用",
        sessionListTitle: "全セッション一覧",
        sessionListMeta: "{{total}} 件",
        loadListFailed: "セッション一覧の取得に失敗しました。",
        noSessions: "対象セッションがありません。",
        previous: "前へ",
        next: "次へ",
        page: "{{current}} / {{total}} ページ",
        sessionDetailTitle: "セッション詳細",
        sessionDetailDescription: "メタ情報と履歴サマリ件数",
        loadDetailFailed: "セッション詳細の取得に失敗しました。",
        selectSessionPrompt: "一覧からセッションを選択してください。",
        unassignedOwner: "owner 未設定",
        notEnded: "未終了",
        labels: {
          sessionId: "セッションID",
          meetingId: "会議ID",
          owner: "オーナー",
          startedAt: "開始時刻",
          endedAt: "終了時刻",
        },
        countsTitle: "履歴サマリ",
        counts: {
          transcripts: "文字起こしセグメント: {{count}}",
          analyses: "解析: {{count}}",
          images: "生成画像: {{count}}",
          captures: "カメラキャプチャ: {{count}}",
          audio: "音声ファイル: {{count}}",
        },
        status: {
          all: "全ステータス",
          idle: "待機",
          recording: "録音中",
          processing: "処理中",
          error: "エラー",
        },
      },
      meeting: {
        newMeetingDialogTitle: "新しい会議",
        titlePlaceholder: "会議タイトル",
        titlePlaceholderOptional: "会議タイトル（任意）",
        startNewMeeting: "新しい会議を開始",
        pastMeetings: "過去の会議",
        refresh: "更新",
        refreshMeetingList: "会議一覧を更新",
        listConnectionUnstable: "接続が不安定です。更新して再試行できます。",
        listUpdating: "過去の会議を更新中...",
        noPastMeetings: "過去の会議はありません",
        unknownDate: "不明",
        untitled: "無題の会議",
        clickToEditTitle: "クリックしてタイトルを編集",
        listTimeoutError: "過去の会議の取得に失敗しました。再試行してください。",
        sectionTitle: "会議",
        newMeeting: "新しい会議",
        noPreviousMeetings: "以前の会議はありません",
        readOnlyBadge: "閲覧専用",
        resumeMeeting: "会議を再開",
      },
      report: {
        menu: "ダウンロード",
        download: "レポートDL",
        downloadAudio: "音声DL",
        downloadSelectedAudio: "選択した音声をDL",
        audioSelectLabel: "ダウンロードする音声を選択",
        audioLoading: "音声一覧を読み込み中...",
        audioEmpty: "音声データがありません",
        audioLoadFailed: "音声一覧の取得に失敗しました。",
        downloading: "レポートDL中...",
        downloadFailed: "レポートのダウンロードに失敗しました。",
      },
      dialog: {
        discardUnsavedRecording: "未保存のローカル音声があります。この会議を離れて破棄しますか？",
      },
      recording: {
        grantCameraMic: "カメラ・マイクへのアクセスを許可",
        shareScreenMic: "画面共有とマイクを許可",
        stopRecording: "録音停止",
        startRecording: "録音開始",
        selectMeetingFirst: "先に会議を選択",
        startOrJoinMeetingFirst: "先に会議を開始または参加してください",
        readOnly: "閲覧専用",
        permissionDeniedHelp:
          "このサイトでカメラ/マイクを許可するようブラウザ設定を確認してください。",
        saveToCloud: "クラウドに保存",
        uploadingWithProgress: "アップロード中... {{progress}}%",
        saved: "保存済み",
        cancelUpload: "アップロードをキャンセル",
        selectMicrophone: "マイクを選択",
        microphoneWithIndex: "マイク {{index}}",
        selectCamera: "カメラを選択",
        cameraWithIndex: "カメラ {{index}}",
        camera: "カメラ",
        screen: "画面共有",
        cameraNotAvailable: "カメラを利用できません",
        screenNotShared: "画面共有されていません",
        recIndicator: "録画中",
        sttReconnecting: "文字起こしを再接続中（{{attempt}}回目）...",
        sttDegraded: "文字起こしが一時的に停止しています。録音は継続中です。",
        sttFailed: "文字起こしの自動復旧に失敗しました。録音を再開してください。",
      },
      summary: {
        title: "要約",
        previousPage: "前の要約ページ",
        nextPage: "次の要約ページ",
        pageLabel: "ページ {{index}}",
        viewList: "一覧表示",
        viewPaged: "ページ表示",
        switchToListView: "要約を一覧表示に切り替え",
        switchToPagedView: "要約をページ表示に切り替え",
        liveTranscript: "リアルタイム文字起こし",
        emptyTranscript: "録音を開始すると文字起こしが表示されます...",
        analyzing: "解析中...",
        noTopicDetected: "トピック未検出",
        speakerWithIndex: "話者 {{index}}",
        editSpeakerLabel: "話者{{index}}の表示名を編集",
      },
      graphics: {
        tooltip: "Flash（速度） / Pro（品質）\\n使用中: {{model}}",
        flash: "Flash",
        pro: "Pro",
        proNotConfigured: "Proモデルが未設定です（GEMINI_IMAGE_MODEL_PRO）",
        failedToLoadImage: "画像を読み込めませんでした",
        previousImage: "前の画像",
        nextImage: "次の画像",
        placeholder: "グラフィック記録はここに表示されます",
        thumbnailAlt: "サムネイル {{index}}",
        retrying: "再試行中...",
        generatingImage: "画像を生成中...",
      },
      layout: {
        expandPane: "ペインを拡大",
        popoutPane: "ペインをポップアウト",
        collapsePane: "ペインを縮小",
        paneOpenInSeparateWindow: "{{label}} は別ウィンドウで開いています",
        clickToFocus: "クリックしてフォーカス",
        paneSummary: "要約",
        paneCamera: "カメラ",
        paneGraphics: "グラフィックス",
      },
      metrics: {
        flow: "流れ",
        heat: "熱量",
      },
    },
  },
} as const;

export type AppLanguage = "ja" | "en";

export function toAppLanguage(value: string | null | undefined): AppLanguage {
  return value?.toLowerCase().startsWith("ja") ? "ja" : "en";
}

if (!i18n.isInitialized) {
  void i18n
    .use(LanguageDetector)
    .use(initReactI18next)
    .init({
      resources,
      fallbackLng: "en",
      supportedLngs: ["ja", "en"],
      nonExplicitSupportedLngs: true,
      detection: {
        order: ["localStorage", "navigator"],
        caches: ["localStorage"],
        lookupLocalStorage: LANGUAGE_STORAGE_KEY,
      },
      interpolation: {
        escapeValue: false,
      },
      react: {
        useSuspense: false,
      },
      initImmediate: false,
      returnNull: false,
    });
}

export { i18n };
